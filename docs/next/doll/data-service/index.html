<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Matryoshka Watchmen RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Matryoshka Watchmen Atom Feed"><title data-react-helmet="true">Data Service | Matryoshka Watchmen</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://imma-watchmen.com/docs/next/doll/data-service"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="keywords" content="matryoshka, watchmen, data lake, lakehouse, pipeline, analysis, warehouse"><meta data-react-helmet="true" property="og:title" content="Data Service | Matryoshka Watchmen"><meta data-react-helmet="true" name="description" content="Data service is designed for serve such as definition CURD, pipeline and inquiry. It is split to several modules:"><meta data-react-helmet="true" property="og:description" content="Data service is designed for serve such as definition CURD, pipeline and inquiry. It is split to several modules:"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://imma-watchmen.com/docs/next/doll/data-service"><link data-react-helmet="true" rel="alternate" href="https://imma-watchmen.com/docs/next/doll/data-service" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://imma-watchmen.com/docs/next/doll/data-service" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.1beb34a7.css">
<link rel="preload" href="/assets/js/runtime~main.a3f72a9b.js" as="script">
<link rel="preload" href="/assets/js/main.a3245157.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Matryoshka" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="Matryoshka" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Matryoshka Watchmen</b></a><a class="navbar__item navbar__link" href="/tutorial/tutorial-index">Tutorial</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/next/docs-index">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs/next/docs-index">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/doll/data-service">Next</a></li><li><a class="dropdown__link" href="/docs/docs-index">15.2.14</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><a href="https://github.com/Indexical-Metrics-Measure-Advisory" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a tabindex="-1" class="sidebarLogo_hmkv" href="/"><img src="/img/logo.svg" alt="Matryoshka" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="Matryoshka" class="themedImage_TMUO themedImage--dark_uzRr"><b>Matryoshka Watchmen</b></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/next/docs-index">Hello World</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/next/main-concepts/main-concepts-what-expected">Main Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/next/web-client/web-client-index">Web Client</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/next/doll/doll-index">Doll</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/doll/doll-index">Doll Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/doll/data-service">Data Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/doll/pipeline-service">Pipeline Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/doll/inquiry-service">Inquiry Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/doll/rest-doll">Doll REST</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/next/doll/utilities/date-time">Utilities</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/next/dqc/dqc-index">Data Quality Center</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/next/installation/config">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/next/appendix/license">Appendix</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Matryoshka Watchmen<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/docs-index">latest version</a></b> (<!-- -->15.2.14<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->Next</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Data Service</h1></header><p>Data service is designed for serve such as definition CURD, pipeline and inquiry. It is split to several modules:</p><ul><li>Model,</li><li>Storage,<ul><li>MySQL,</li><li>Oracle,</li><li>MongoDB,</li><li>MSSQL,</li></ul></li><li>Meta,</li><li>Data Kernel,</li><li>Data Surface.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="model">Model<a class="hash-link" href="#model" title="Direct link to heading">â€‹</a></h2><p>In <code>watchmen-model</code>, all tuples are defined. Basically, they can be arranged to 3 catalogs:</p><ul><li>Tenant based,</li><li>User based,</li><li>Others.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="tenant-based">Tenant Based<a class="hash-link" href="#tenant-based" title="Direct link to heading">â€‹</a></h3><p>Tenant based models are designed to be shared in tenant, most tenant based models have optimistic lock:</p><ul><li>Tenant,</li><li>User,</li><li>Data Source,</li><li>External Writer,</li><li>User Group,</li><li>Space,</li><li>Enumeration,</li><li>Topic,</li><li>Pipeline,</li><li>Catalog,</li><li>Monitor Rule (no optimistic lock declared).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="user-based">User Based<a class="hash-link" href="#user-based" title="Direct link to heading">â€‹</a></h3><p>User based models are designed to store data which belongs to particular user only:</p><ul><li>Favorite,</li><li>Last Snapshot,</li><li>Personal Access Token,</li><li>Connected Space,</li><li>Connected Space Graphic,</li><li>Subject,</li><li>Report,</li><li>Dashboard,</li><li>Pipeline Graphic.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="others">Others<a class="hash-link" href="#others" title="Direct link to heading">â€‹</a></h3><p>Typically, model which is not a tenant based or an user based, is designed for system purpose.</p><ul><li>Factor Index</li><li>Pipeline Index</li><li>Key Store</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="meta-service">Meta Service<a class="hash-link" href="#meta-service" title="Direct link to heading">â€‹</a></h2><p>The CRUD operations of models are provided by <code>watchmen-meta</code>, and persistent layer of meta service is provided by <code>watchmen-storage</code>. All
metadata are stored in one storage, it can be RDS or NoSQL.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="storage">Storage<a class="hash-link" href="#storage" title="Direct link to heading">â€‹</a></h2><p><code>watchmen-storage</code> is spi for different types of storages, such as MySQL, Oracle, etc. To enable the particular storage, the adaptive
implementation module should be included.</p><p>Storage provides persistent layer both for meta service and data service. For meta service, find configuration
details <strong><a href="/docs/next/installation/config#meta">here</a>.</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="snowflake-sequence-generator">Snowflake Sequence Generator<a class="hash-link" href="#snowflake-sequence-generator" title="Direct link to heading">â€‹</a></h3><p>In storage module, there is a built-in snowflake sequence generator. Small changes made based on the standard algorithm, which are:</p><ul><li>At most 4 data centers are supported, default is 0,</li><li>At most 1024 workers for each data center are supported, default is 0 too.</li></ul><p>It is expected that worker ids setting can be ignored when deploy watchmen to servers, it is no need to care about settings for each server
, docker image and system variables of host server. Consider of this, a built-in mechanism called competitive worker is provided, and by
default it is enabled. It acquires a worker id when server starting, and keep declaring itself alive to meta storage every 60 seconds when
default settings is kept. Plus, an unused worker id would be released and reused after 1 day.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Default competitive worker is based on persistent layer, all data can be found at <code>snowflake_competitive_workers</code>. Manually clean dead
worker ids when necessary.</p></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Declare data center id and worker id by system variables for each node separated is recommended where conditions permit. Simply disable the
competitive workers by settings parameter.   </p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="extend-data-source-types">Extend Data Source Types<a class="hash-link" href="#extend-data-source-types" title="Direct link to heading">â€‹</a></h3><p>MySQL and Oracle is built-in now, MSSQL and mongoDB are in plan now. If you want to extend a new data source type, follow the steps to
create supporting a type <code>SomeDB</code>.</p><p>First fork our repo, for server side,</p><ul><li>Add a new package, which named <code>watchmen-storage-somedb</code>,</li><li>Copy source from the analogue, such as from <code>watchmen-storage-mysql</code>,</li><li>Go through source codes, change them,<ul><li>If it is only for topic data, only a few apis should be implemented, find <code>watchmen-inquiry-trino</code> as a sample,</li><li>If it is for metadata, most apis must be implemented except the apis which are used for inquiry subject and report data,</li><li>If it is for both metadata and topic data, all apis have to be implemented,</li></ul></li><li>Add data source types into <code>DataSourceType</code>, which in <code>watchmen-model</code>,</li><li>Add dependency into doll and dqc instance.</li><li>Bingo!</li></ul><p>For defined new data source type in web client, you need to,</p><ul><li>Add data source types into <code>DataSourceType</code>, which in <code>data-source-types.ts</code>,</li><li>Add dropdown label into <code>DataSourceTypeInput</code>, which in <code>data-source-type-input.tsx</code>,</li><li>Bingo!</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="data-kernel-and-surface">Data Kernel and Surface<a class="hash-link" href="#data-kernel-and-surface" title="Direct link to heading">â€‹</a></h2><p>A set of services and rest apis are provided by data kernel and surface. Pipeline and inquiry services are built based on data kernel.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="cache-service">Cache service<a class="hash-link" href="#cache-service" title="Direct link to heading">â€‹</a></h3><ul><li>Data Sources for topic data,</li><li>External writers,</li><li>Topics,</li><li>Pipelines,</li><li>Relationship between topics and pipelines,</li><li>Key store,</li><li>Tenant.</li></ul><p>A high frequency question is, how to refresh cache, there are multiple servers and only one node can be cleared when call clear cache rest
api. For this situation, a heart beat cache refresher is built-in, and visit <strong><a href="/docs/next/installation/config#data-kernel">here</a></strong> for more
details.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Heart beat of in-memory cache is not recommend in production.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="topic-data">Topic Data<a class="hash-link" href="#topic-data" title="Direct link to heading">â€‹</a></h3><p>All topic data rest apis are available for tenant admin and super admin only.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="retrieve-data-of-single-topic">Retrieve data of single topic<a class="hash-link" href="#retrieve-data-of-single-topic" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--location </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--request POST </span><span class="token string" style="color:#e3116c">&#x27;http://host:port/topic/data?topic_name=a_topic&amp;tenant_id=1&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Authorization: Bearer ...&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw </span><span class="token string" style="color:#e3116c">&#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;pageNumber&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;pageSize&quot;: 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>topic_name</code>: case sensitive,</li><li><code>tenant_id</code>: required when current user is super admin.</li></ul><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>There is no page size limitation for this api, be careful about memory and data size.</p></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="truncate-a-single-topic">Truncate a single topic<a class="hash-link" href="#truncate-a-single-topic" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--location </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--request DELETE </span><span class="token string" style="color:#e3116c">&#x27;http://host:port/topic/data/truncate?topic_name=a_topic&amp;tenant_id=1&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Authorization: Bearer ...&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>topic_name</code>: case sensitive,</li><li><code>tenant_id</code>: required when current user is super admin.</li></ul><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>There is no rollback of truncate operation, it is equivalent with database truncate.</p></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="patch-topic-data">Patch topic data<a class="hash-link" href="#patch-topic-data" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--location </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--request PATCH </span><span class="token string" style="color:#e3116c">&#x27;http://host:port/topic/data/patch?topic_name=a_topic&amp;patch_type=merge&amp;tenant_id=1&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Authorization: Bearer ...&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--data-raw </span><span class="token string" style="color:#e3116c">&#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>topic_name</code>: case sensitive,</li><li><code>patch_type</code>: one of <code>merge</code>, <code>insert</code> and <code>delete</code>,<ul><li>for <code>merge</code> and <code>delete</code>: a property <code>id_</code> is required in body data,</li><li>for <code>merge</code> and aggregation topic: a property <code>version_</code> is required in body data,</li><li>for <code>insert</code>: <code>id_</code> will be generated, <code>version_</code> is 1 when it is required,</li></ul></li><li><code>tenant_id</code>: required when current user is super admin.</li></ul><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>No pipeline will be triggered on data patch.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Indexical-Metrics-Measure-Advisory/watchmen-docs/tree/main/docs/040-doll/100-data-service.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-03-25T09:17:21.000Z">3/25/2022</time></b> by <b>botlikes</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/next/doll/doll-index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Doll Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/next/doll/pipeline-service"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pipeline Service</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model" class="table-of-contents__link toc-highlight">Model</a><ul><li><a href="#tenant-based" class="table-of-contents__link toc-highlight">Tenant Based</a></li><li><a href="#user-based" class="table-of-contents__link toc-highlight">User Based</a></li><li><a href="#others" class="table-of-contents__link toc-highlight">Others</a></li></ul></li><li><a href="#meta-service" class="table-of-contents__link toc-highlight">Meta Service</a></li><li><a href="#storage" class="table-of-contents__link toc-highlight">Storage</a><ul><li><a href="#snowflake-sequence-generator" class="table-of-contents__link toc-highlight">Snowflake Sequence Generator</a></li><li><a href="#extend-data-source-types" class="table-of-contents__link toc-highlight">Extend Data Source Types</a></li></ul></li><li><a href="#data-kernel-and-surface" class="table-of-contents__link toc-highlight">Data Kernel and Surface</a><ul><li><a href="#cache-service" class="table-of-contents__link toc-highlight">Cache service</a></li><li><a href="#topic-data" class="table-of-contents__link toc-highlight">Topic Data</a><ul><li><a href="#retrieve-data-of-single-topic" class="table-of-contents__link toc-highlight">Retrieve data of single topic</a></li><li><a href="#truncate-a-single-topic" class="table-of-contents__link toc-highlight">Truncate a single topic</a></li><li><a href="#patch-topic-data" class="table-of-contents__link toc-highlight">Patch topic data</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tutorial/tutorial-index">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docs-index">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Indexical-Metrics-Measure-Advisory/watchmen" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Doll &amp; DQC<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Matryoshka Watchmen. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a3f72a9b.js"></script>
<script src="/assets/js/main.a3245157.js"></script>
</body>
</html>