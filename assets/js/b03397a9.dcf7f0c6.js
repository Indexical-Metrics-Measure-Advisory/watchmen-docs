"use strict";(globalThis.webpackChunkwatchmen_docs=globalThis.webpackChunkwatchmen_docs||[]).push([[77065],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var i=t(96540);const l={},a=i.createContext(l);function s(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(a.Provider,{value:n},e.children)}},77750:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"deployment/deploy-index","title":"Deployment Index","description":"Dev env","source":"@site/versioned_docs/version-15.2.14/deployment/deploy-index.md","sourceDirName":"deployment","slug":"/deployment/deploy-index","permalink":"/docs/15.2.14/deployment/deploy-index","draft":false,"unlisted":false,"editUrl":"https://github.com/Indexical-Metrics-Measure-Advisory/watchmen-docs/tree/main/versioned_docs/version-15.2.14/deployment/deploy-index.md","tags":[],"version":"15.2.14","lastUpdatedBy":"luke0623","lastUpdatedAt":1767196450000,"sidebarPosition":1,"frontMatter":{"id":"deploy-index","title":"Deployment Index","sidebar_position":1},"sidebar":"sidebar","previous":{"title":"Extend External Writer","permalink":"/docs/15.2.14/doll/extend/extend-external-writer"},"next":{"title":"Integration","permalink":"/docs/15.2.14/deployment/integration-index"}}');var l=t(74848),a=t(28453);const s={id:"deploy-index",title:"Deployment Index",sidebar_position:1},c="Deployment",r={},o=[{value:"Dev env",id:"dev-env",level:2},{value:"Production env",id:"production-env",level:2},{value:"Installation prerequisites:",id:"installation-prerequisites",level:3},{value:"Watchmen components",id:"watchmen-components",level:3},{value:"Watchmen web client",id:"watchmen-web-client",level:4},{value:"Watchmen doll",id:"watchmen-doll",level:4},{value:"Watchmen dqc",id:"watchmen-dqc",level:4},{value:"Presto(Trino)",id:"prestotrino",level:4},{value:"Initial environment",id:"initial-environment",level:3},{value:"Install watchmen doll and watchmen web client",id:"install-watchmen-doll-and-watchmen-web-client",level:4},{value:"Deploy watchmen database",id:"deploy-watchmen-database",level:4},{value:"Deploy watchmen asset",id:"deploy-watchmen-asset",level:4},{value:"Install trino cluster",id:"install-trino-cluster",level:4},{value:"Install watchmen-dqc",id:"install-watchmen-dqc",level:4}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,l.jsx)(n.h2,{id:"dev-env",children:"Dev env"}),"\n",(0,l.jsx)(n.p,{children:"Run docker-compose file for MySQL or MongoDB"}),"\n",(0,l.jsxs)(n.p,{children:["Ref to ",(0,l.jsx)(n.a,{href:"https://github.com/Indexical-Metrics-Measure-Advisory/watchmen-quick-start",children:(0,l.jsx)(n.strong,{children:"quick start repository"})})]}),"\n",(0,l.jsx)(n.h2,{id:"production-env",children:"Production env"}),"\n",(0,l.jsx)(n.h3,{id:"installation-prerequisites",children:"Installation prerequisites:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Operating System: Linux"}),"\n",(0,l.jsx)(n.li,{children:"Container: Docker and Docker Compose"}),"\n",(0,l.jsx)(n.li,{children:"Database: MySQL 8"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Supported database type:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"MySQL"}),"\n",(0,l.jsx)(n.li,{children:"Oracle"}),"\n",(0,l.jsx)(n.li,{children:"MongoDB"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"watchmen-components",children:"Watchmen components"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"watchmen-web-client"}),"\n",(0,l.jsx)(n.li,{children:"watchmen-matryoshka-doll"}),"\n",(0,l.jsx)(n.li,{children:"watchmen-dqc"}),"\n",(0,l.jsx)(n.li,{children:"presto"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"watchmen-web-client",children:"Watchmen web client"}),"\n",(0,l.jsx)(n.p,{children:"Watchmen's front desk"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/indexical-metrics-measure-advisory/watchmen-web-client:{version}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"watchmen-doll",children:"Watchmen doll"}),"\n",(0,l.jsx)(n.p,{children:"Watchmen's backend server \uff08python\uff09"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-doll:{version}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"watchmen-dqc",children:"Watchmen dqc"}),"\n",(0,l.jsx)(n.p,{children:"Watchmen's data quality center (python)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-dqc:{version}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"prestotrino",children:"Presto(Trino)"}),"\n",(0,l.jsx)(n.p,{children:"Fast distributed SQL query engine for big data analytics"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://hub.docker.com/r/trinodb/trino",children:(0,l.jsx)(n.strong,{children:"docker trino"})})}),"\n",(0,l.jsx)(n.h3,{id:"initial-environment",children:"Initial environment"}),"\n",(0,l.jsx)(n.p,{children:"A new environment needs to be initialized. The steps are as follows:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Deploy the database script for watchmen definition database."}),"\n",(0,l.jsx)(n.li,{children:"Install watchmen component\uff08web client, doll, dqc, trino\uff09."}),"\n",(0,l.jsx)(n.li,{children:"The environment started successfully."}),"\n",(0,l.jsx)(n.li,{children:"Create zone, user, instance datasource online with superuser."}),"\n",(0,l.jsx)(n.li,{children:"Deploy the database script of topics for watchmen instance database."}),"\n",(0,l.jsx)(n.li,{children:"Deploy data asset to the environment."}),"\n",(0,l.jsx)(n.li,{children:"Check all topics, binding the datasource to the topic online with tenant user."}),"\n",(0,l.jsx)(n.li,{children:"Change configuration of trino, add the new datasource to trino server."}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"install-watchmen-doll-and-watchmen-web-client",children:"Install watchmen doll and watchmen web client"}),"\n",(0,l.jsx)(n.p,{children:"Build docker compose. For example:"}),"\n",(0,l.jsx)(n.p,{children:"Two dolls and one web client installed on a node. Generally, N dolls and 1 web client will be deployed on a node"}),"\n",(0,l.jsx)(n.p,{children:"Build docker-compose.yml"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"version: '3'\nservices:\n  watchmen-matryoshka-doll_01:\n    container_name: watchmen-matryoshka-doll_01\n    hostname: component\n    image:  ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-doll:{version}\n    restart: always\n    ports:\n      - \"{host_port}:80\"\n    env_file:\n      - {config_file}\n    volumes:\n      - {mount_path}:/app/temp/\n    network_mode: 'bridge'\n  watchmen-matryoshka-doll_02:\n    container_name: watchmen-matryoshka-doll_02\n    hostname: component\n    image: ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-doll:{version}\n    restart: always\n    ports:\n      - \"{host_port}:80\"\n    env_file:\n      - {config_file}\n    volumes:\n      - {mount_path}:/app/temp/\n    network_mode: 'bridge'\n\n  watchmen-web-client:\n    container_name: watchmen-web-client\n    hostname: component\n    image: ghcr.io/indexical-metrics-measure-advisory/watchmen-web-client:{version}\n    restart: always\n    ports:\n      - \"{host_port}:80\"\n    volumes:\n      - {mount_file}:/etc/nginx/nginx.conf\n    links:\n      - watchmen-matryoshka-doll\n    network_mode: 'bridge'\n"})}),"\n",(0,l.jsx)(n.p,{children:"Watchmen-matryoshka-doll's configuration"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"config_file"})," of doll, please refer to ",(0,l.jsx)(n.a,{href:"../doll/doll-configuration",children:"doll configuration"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"Configure watchmen-web-client as a reverse proxy for HTTP."}),"\n",(0,l.jsx)(n.p,{children:"Configuration fragment of watchmen web client (nginx):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-nginx",children:"upstream watchmen_doll {\n    server IP1:PORT1;\n    \u2026\u2026\u2026\u2026\n    server IP1:PORT2;\n    server IP2:PORT1;\n    \u2026\u2026\u2026\u2026\n    server IP2:PORT2;\n}\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-nginx",children:"location /watchmen/ {\n  proxy_pass http://watchmen_doll/;\n}\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-nginx",children:"location /watchmen/dqc/ {\n  proxy_pass http://ip:port/dqc/;\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"deploy-watchmen-database",children:"Deploy watchmen database"}),"\n",(0,l.jsx)(n.p,{children:"Watchmen only provides the database script project."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/Indexical-Metrics-Measure-Advisory/watchmen-dbscript",children:(0,l.jsx)(n.strong,{children:"watchmen dbscript"})})}),"\n",(0,l.jsx)(n.p,{children:"Watchmen don't provide the release package of database."}),"\n",(0,l.jsx)(n.p,{children:"It is recommended to build the release package of database by combining liquibase with database script, package into a container to execute."}),"\n",(0,l.jsx)(n.p,{children:"Project sample"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"watchmen-dbscript-deployment\n|-dbscript\n   |-initial\n     |-doll\n        |-init_watchmen.xml\n        |-initial_mysql.sql\n        |-initial_user_mysql.sql\n     |-dqc\n        |-initial.mysql.sql \n   |- upgrade-db.xml\n|-lib\n   |-mysql-connector-java-8.0.27\n|-Dockerfile\n"})}),"\n",(0,l.jsx)(n.p,{children:"Dockerfile sample:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:"FROM liquibase/liquibase:4.3.5\n\nWORKDIR /app\n\nCOPY dbscript/ /liquibase/changelog\nCOPY lib/ /liquibase/classpath\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-commandline",children:'docker run --rm liquibase/liquibase:4.3.5 --changeLogFile=upgrade-db.xml --url="jdbc:mysql://172.15.14.26:3306/watchmen" --username=test_watchmen --password=test_watchmenpwd --classpath=/liquibase/changelog:/liquibase/classpath/mysql-connector-java-8.0.27.jar --logLevel=debug update\n'})}),"\n",(0,l.jsx)(n.h4,{id:"deploy-watchmen-asset",children:"Deploy watchmen asset"}),"\n",(0,l.jsx)(n.p,{children:"The watchmen asset is in the form of Markdown file and can be exported on the page."}),"\n",(0,l.jsx)(n.p,{children:"Use the watchmen-cli component to publish the asset to corresponding environment."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://github.com/Indexical-Metrics-Measure-Advisory/watchmen-cli",children:(0,l.jsx)(n.strong,{children:"watchmen cli"})})}),"\n",(0,l.jsx)(n.p,{children:"It is recommended package the asset release package with watchmen-cli into a container to execute."}),"\n",(0,l.jsx)(n.p,{children:"Project sample"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:"watchmen-asset-deployment\n|-config\n   |-log-asset.md\n|-Dockerfile\n"})}),"\n",(0,l.jsx)(n.p,{children:"Dockerfile sample"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-dockerfile",children:"FROM indexical-metrics-measure-advisory/watchmen-cli:1.0.3\n\nWORKDIR /app\n\nCOPY config/ /app/config \n"})}),"\n",(0,l.jsx)(n.p,{children:"Start deploy asset container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-commandline",children:"docker run --rm -e command=deploy_asset -e host=http://watchmen-matryoshka-doll -e username=imma-admin -e password=abc1234 indexical-metrics-measure-advisory/watchmen-cli:1.0.3\n"})}),"\n",(0,l.jsx)(n.h4,{id:"install-trino-cluster",children:"Install trino cluster"}),"\n",(0,l.jsxs)(n.p,{children:["ref to ",(0,l.jsx)(n.a,{href:"https://trino.io/docs/current/installation/deployment.html?highlight=cluster#",children:(0,l.jsx)(n.strong,{children:"trino cluster"})})]}),"\n",(0,l.jsx)(n.p,{children:"Storage(data source):"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Datasource extension online is not supported by presto (trino), manually add new catalog into presto (trino) is a must."}),"\n",(0,l.jsx)(n.li,{children:"Datasource code must be consistent with prefix in presto (trino) catalog configuration file, which means datasource code in watchmen also has to follow this principle as well"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"install-watchmen-dqc",children:"Install watchmen-dqc"}),"\n",(0,l.jsx)(n.p,{children:"At present, DQC only supports stand-alone deployment. You can use the host mode for container network."}),"\n",(0,l.jsx)(n.p,{children:"Deploy dqc database script:"}),"\n",(0,l.jsx)(n.p,{children:'Please refer to "Deploy watchmen database".'}),"\n",(0,l.jsx)(n.p,{children:"Start dqc container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-commandline",children:"docker run --net=host --name watchmen-dqc -v {mount_path}:/app/temp --env-file {config_file} -p {host_port}:80 -d  indexical-metrics-measure-advisory/watchmen-dqc:{version}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Configuration of dqc:"}),"\n",(0,l.jsxs)(n.p,{children:["Please refer to ",(0,l.jsx)(n.a,{href:"../doll/doll-configuration",children:"dqc configuration"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);