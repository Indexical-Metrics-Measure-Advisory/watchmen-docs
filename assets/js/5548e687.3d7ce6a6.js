"use strict";(globalThis.webpackChunkwatchmen_docs=globalThis.webpackChunkwatchmen_docs||[]).push([[47611],{20409:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"installation/deploy","title":"Deployment","description":"Dev Environment","source":"@site/versioned_docs/version-16.2/060-installation/030-deploy.md","sourceDirName":"060-installation","slug":"/installation/deploy","permalink":"/docs/16.2/installation/deploy","draft":false,"unlisted":false,"editUrl":"https://github.com/Indexical-Metrics-Measure-Advisory/watchmen-docs/tree/main/versioned_docs/version-16.2/060-installation/030-deploy.md","tags":[],"version":"16.2","lastUpdatedBy":"luke0623","lastUpdatedAt":1767281637000,"sidebarPosition":30,"frontMatter":{"id":"deploy","title":"Deployment","sidebar_position":30},"sidebar":"sidebar","previous":{"title":"Storage Scripts","permalink":"/docs/16.2/installation/scripts"},"next":{"title":"Integration","permalink":"/docs/16.2/installation/integration"}}');var t=i(74848),l=i(28453);const o={id:"deploy",title:"Deployment",sidebar_position:30},r="Deployment",a={},d=[{value:"Dev Environment",id:"dev-environment",level:2},{value:"Production Environment",id:"production-environment",level:2},{value:"Installation Prerequisites:",id:"installation-prerequisites",level:3},{value:"Components",id:"components",level:3},{value:"Initial Environment",id:"initial-environment",level:3},{value:"Deploy Database",id:"deploy-database",level:4},{value:"Install Doll and Web Client",id:"install-doll-and-web-client",level:4},{value:"Build a docker compose",id:"build-a-docker-compose",level:5},{value:"Put a reverse proxy in front of dolls",id:"put-a-reverse-proxy-in-front-of-dolls",level:5},{value:"Install DQC REST",id:"install-dqc-rest",level:4},{value:"Deploy Assets",id:"deploy-assets",level:4},{value:"Install Trino Cluster",id:"install-trino-cluster",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,t.jsx)(n.h2,{id:"dev-environment",children:"Dev Environment"}),"\n",(0,t.jsx)(n.p,{children:"Run docker-compose file for MySQL or MongoDB"}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.a,{href:"/tutorial/tutorial-index",children:(0,t.jsx)(n.strong,{children:"Quick Start"})})," for more details."]}),"\n",(0,t.jsx)(n.h2,{id:"production-environment",children:"Production Environment"}),"\n",(0,t.jsx)(n.h3,{id:"installation-prerequisites",children:"Installation Prerequisites:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Operating System: Linux"}),"\n",(0,t.jsx)(n.li,{children:"Container: Docker or Docker Compose"}),"\n",(0,t.jsxs)(n.li,{children:["Database: MySQL 8 or other available storage types:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Oracle"}),"\n",(0,t.jsx)(n.li,{children:"MongoDB"}),"\n",(0,t.jsx)(n.li,{children:"MSSQL"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"components",children:"Components"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"watchmen-web-client"}),": frontend of ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Watchmen"})}),",","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/indexical-metrics-measure-advisory/watchmen-web-client:{version}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"watchmen-rest-doll"}),": backend server of ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Watchmen"})}),",","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-doll:{version}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"watchmen-rest-dqc"}),": Data Quality Center server of ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Watchmen"})}),",","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-dqc:{version}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Trino: fast distributed SQL query engine for big data analytics.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"https://hub.docker.com/r/Trinodb/Trino",children:"Docker Trino"})})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"initial-environment",children:"Initial Environment"}),"\n",(0,t.jsx)(n.p,{children:"A new environment needs to be initialized. The steps are as follows:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Deploy the database script for watchmen definition database,"}),"\n",(0,t.jsx)(n.li,{children:"Install watchmen components: web client, doll, dqc and/or Trino,"}),"\n",(0,t.jsx)(n.li,{children:"The environment started successfully,"}),"\n",(0,t.jsx)(n.li,{children:"Create zone, user, instance datasource online with superuser,"}),"\n",(0,t.jsx)(n.li,{children:"Deploy the database script of topics for watchmen instance database,"}),"\n",(0,t.jsx)(n.li,{children:"Deploy data asset to the environment,"}),"\n",(0,t.jsx)(n.li,{children:"Check all topics, binding the datasource to the topic online with tenant user,"}),"\n",(0,t.jsx)(n.li,{children:"Change configuration of Trino, add the new datasource to Trino server."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"deploy-database",children:"Deploy Database"}),"\n",(0,t.jsxs)(n.p,{children:["Find database scripts from ",(0,t.jsx)(n.code,{children:"watchmen-storage-xxx"})," module based on your meta storage type, and run that by yourself."]}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsx)(n.mdxAdmonitionTitle,{}),(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Watchmen"})})," don't provide the release package of database."]})]}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsx)(n.mdxAdmonitionTitle,{}),(0,t.jsx)(n.p,{children:"All initial scripts are included by storage module, both for doll and DQC."})]}),"\n",(0,t.jsx)(n.h4,{id:"install-doll-and-web-client",children:"Install Doll and Web Client"}),"\n",(0,t.jsx)(n.h5,{id:"build-a-docker-compose",children:"Build a docker compose"}),"\n",(0,t.jsx)(n.p,{children:"For example, two dolls and one web client installed on a node. Typically, N dolls and 1 web client will be deployed on a node"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:"version: '3'\nservices:\n  watchmen-matryoshka-doll_01:\n    container_name: watchmen-matryoshka-doll_01\n    hostname: component\n    image: ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-doll:{version}\n    restart: always\n    ports:\n      - \"{ host_port }:80\"\n    env_file:\n      - { config_file }\n    volumes:\n      - { mount_path }:/app/temp/\n    network_mode: 'bridge'\n  watchmen-matryoshka-doll_02:\n    container_name: watchmen-matryoshka-doll_02\n    hostname: component\n    image: ghcr.io/indexical-metrics-measure-advisory/watchmen-matryoshka-doll:{version}\n    restart: always\n    ports:\n      - \"{ host_port }:80\"\n    env_file:\n      - { config_file }\n    volumes:\n      - { mount_path }:/app/temp/\n    network_mode: 'bridge'\n\n  watchmen-web-client:\n    container_name: watchmen-web-client\n    hostname: component\n    image: ghcr.io/indexical-metrics-measure-advisory/watchmen-web-client:{version}\n    restart: always\n    ports:\n      - \"{ host_port }:80\"\n    volumes:\n      - { mount_file }:/etc/nginx/nginx.conf\n    links:\n      - watchmen-matryoshka-doll\n    network_mode: 'bridge'\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"config",children:"here"})})," for more details of ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Watchmen"})})," configuration."]}),"\n",(0,t.jsx)(n.h5,{id:"put-a-reverse-proxy-in-front-of-dolls",children:"Put a reverse proxy in front of dolls"}),"\n",(0,t.jsx)(n.p,{children:"It also serves the static resource files of web client. Here are some configuration fragments of nginx:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"upstream watchmen_doll {\n    server IP1:PORT1;\n    ...\n    server IP1:PORT2;\n    server IP2:PORT1;\n    ...\n    server IP2:PORT2;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"location /watchmen/ {\n    proxy_pass http://watchmen_doll/;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:"location /watchmen/dqc/ {\n    proxy_pass http://ip:port/dqc/;\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"install-dqc-rest",children:"Install DQC REST"}),"\n",(0,t.jsx)(n.p,{children:"DQC can be deployed standalone, use the host mode for container network. Start DQC by following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run --net=host --name watchmen-dqc \\\n\t-v {mount_path}:/app/temp \\\n\t--env-file {config_file} \\\n\t-p { host_port }:80 \\\n\t-d  indexical-metrics-measure-advisory/watchmen-dqc:{version}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"deploy-assets",children:"Deploy Assets"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"Watchmen"})})," asset files are in the form of Markdown and exported on the web client. Publish asset files to corresponding environment\nby ",(0,t.jsx)(n.code,{children:"watchmen-cli"}),"."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A Project sample, cli detects markdown files under config folder."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"watchmen-asset-deployment\n \u2523 config\n \u2503  \u2517 log-asset.md\n \u2517 Dockerfile\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A Dockerfile sample"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"FROM indexical-metrics-measure-advisory/watchmen-cli:{version}\nWORKDIR /app\nCOPY config/ /app/config\n"})}),"\n",(0,t.jsx)(n.p,{children:"Deploy by docker:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run --rm -e command=deploy_asset \\\n\t-e host=http://host-of-doll:port \\\n\t-e username=imma-admin \\\n\t-e password=abc1234 indexical-metrics-measure-advisory/watchmen-cli:{version}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"install-trino-cluster",children:"Install Trino Cluster"}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.a,{href:"https://Trino.io/docs/current/installation/deployment.html?highlight=cluster#",children:(0,t.jsx)(n.strong,{children:"Trino Cluster"})})," for more details."]}),"\n",(0,t.jsx)(n.p,{children:"For storage datasource:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Datasource extension in runtime is not supported by Trino, manually add new catalog into Trino is a must."}),"\n",(0,t.jsx)(n.li,{children:"Datasource code must be consistent with prefix in Trino catalog, which means datasource code in watchmen also has to follow this principle\nas well."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Visit ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"../installation/config",children:"here"})})," for more details about DQC configuration."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var s=i(96540);const t={},l=s.createContext(t);function o(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);